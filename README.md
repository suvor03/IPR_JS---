Обработчик загрузки склада продукцией
============================
Индекс проекта: TRUCKGEN

## Описание бизнес процесса

Термины:
- слот - ячейка/участок склада, хранящий установленное количество тонн определенного типа продукта
- склад - некоторое пространство, для хранения разных типов продукции распределенных по слотам
- грузовик - автотранспорт загруженный определенным кол-вом груза
- грузоподъемность - максимально-возможный объем тонн транспортировки груза для одного грузовик

Сценарий обработки:  
Раз в неделю из точки А (место загрузки) отправляется определенное кол-во грузовики с продукцией. Каждый грузовик может перевозить только один тип продукции, в соответствии с грузоподъемностью. В точке Б (склад разгрузки) выполняется разгрузка продукции грузовика в соответствии с условиями для определенного типа продукции. Склад поделен на слоты для хранения разных типов продукции. Каждый слот хранит определенное кол-во тонн одного типа продукции.  
По итогу обработки всех грузовиков, диспетчер получает информацию о состоянии слотов склада, процесса разгрузки грузовиков, в т.ч. ошибках возникших при загрузке. Вывод информации пользователю доступен как в окне браузера (см. [требуемый формат вывода в браузере](./docs/browser_output_example.html)), с сохранением сформированного вывода в формате html, так и в интерфейса командной строки (см. [требуемый формат в cmd](./docs/cmd_output_example.log)).

## Общие объекты

### Enum Event
тип хранения событий обработки
- `GATEWAY_START` - событие начала обработки всех грузовиков
- `GATEWAY_DONE` - событие завершения обработки всех грузовиков
- `PROCESS_TRUCK_START` - событие начала обработки грузовика
- `PROCESS_TRUCK_DONE` - событие окончания обработки грузовика
- `PROCESS_TRUCK_FAIL` - событие неудачной обработки грузовика

### Class app\ProductTypes
тип хранения типов продукции. Доступны 4 типа:
- Тропические масла
- Специи
- Сырный порошок
- Защищенные белки

### Class app\DTO
класс объекта хранения контекста обработки  
**публичные свойства:**
| Свойство         | Тип   | Описание                         |
|------------------|-------|----------------------------------|
| readonly $trucks | array | объекты грузовиков для обработки |

### Class app\Slot
класс объекта слота размещения продукции определенного типа и объема  
**публичные свойства:**
| Свойство       | Тип              | Описание                     |
|----------------|------------------|------------------------------|
| readonly $type | app\ProductTypes | тип продукции                |
| $freeSpace     | int              | свободный объем для хранения |

### Class app\Truck
класс объекта грузовика  
**публичные свойства:**
| Свойство           | Тип              | Описание         |
|--------------------|------------------|------------------|
| readonly $id       | string           | идентификатор    |
| readonly $type     | app\ProductTypes | тип продукции    |
| readonly $capacity | int              | грузоподъемность |

### Class app\TruckFactory
класс объекта фабрики грузовиков, загруженных типами продукции с указанием массы груза  
**приватные свойства:**
| Свойство               | Тип            | Описание       |
|------------------------|----------------|----------------|
| readonly $productTypes | ProductTypes[] | типы продукции |

**публичные методы:**
| Метод          | Входящие типы                                                    | Возвращаемый тип | Описание                                                                                 |
|----------------|------------------------------------------------------------------|------------------|------------------------------------------------------------------------------------------|
| createTrucks() | int $trucksCount необходимое кол-во грузовиков (произвольное число) | Truck[]          | генерация случайного кол-ва грузовиков, загруженных определенными типами продукции |

### Class app\Warehouse
класс объекта склада хранения и загрузки слотов размещения типов продукций определенного объема, поставляемых грузовиками
**приватные свойства:**
| Свойство         | Тип           | Описание                   |
|------------------|---------------|----------------------------|
| static $instance | app\Warehouse | объект склада              |
| $slots           | Slot[]        | слоты размещения продукции |

**публичные методы:**
| Метод                | Входящие типы                                                                                                     | Возвращаемый тип | Описание                                                            |
|----------------------|-------------------------------------------------------------------------------------------------------------------|------------------|---------------------------------------------------------------------|
| static getInstance() | отсутствуют                                                                                                       | app\Warehouse    | возвращает единый экземпляр объекта склада                          |
| __clone()            | отсутствуют                                                                                                       | never            | клонирование единого экземпляра объекта склада (не доступно)        |
| static getSlots()    | отсутствуют                                                                                                       | Slot[]           | возврата текущего состояния слотов размещения продукции             |
| loadSlotsOnce()      | Slot[] $slots - слоты размещения продукции                                                                        | void             | единовременное добавление слотов размещения продукции               |
| getSlotFreeSpace()   | ProductTypes $type                                                                                                | int              | получение информации о свободном объеме для хранения типа продукции |
| loadSlot()           | ProductTypes $type - тип продукции, поставляемой на склад, int $capacity - объем продукции, поставляемой на склад | void             | загрузка типа продукции на склад в указанном объеме                 |

## Стратегии разгрузки

### Interface app\strategies\StrategyInterface
интерфейс классов объектов стратегий разгрузки продукции
**методы**
| Метод            | Входящие типы                           | Возвращаемый тип | Описание                                            |
|------------------|-----------------------------------------|------------------|-----------------------------------------------------|
| getProductType() | отсутствуют                             | App\ProductTypes | получить тип разгружаемой продукции                 |
| unload()         | App\Truck $item - разгружаемый грузовик | void             | разгрузить грузовик в слот склада по типу продукции |

### Class app\strategies\CheesePowderUnloadStrategy
класс объекта стратегии разгрузки продукции типа "Сырный порошок".  
стратегия выполняется при условии, что вместимость слота хранения объемом не менее объема груза грузовика.
Особенность разгрузки типа "Сырный порошок":  
груз насыпной. На станции погрузки насып продукции осуществляется с погрешностью в 4 тонны на каждые 25 тонн. При расчете свободного места для разгрузки на складе необходимо добавлять 4 тонны запасом на каждые 25 тонн.
**публичные методы:**
см. интерфейс app\strategies\StrategyInterface

### Class app\strategies\SpicesUnloadStrategy
класс объекта стратегии разгрузки продукции типа "Специи".  
Особенность разгрузки типа "Специи":  
груз насыпной. Поставляется в запечатанных контейнерах. Разгрузка осуществляется, при условии что текущий доступный объем на складе кратен объему груза в грузовике.
**публичные методы:**
см. интерфейс app\strategies\StrategyInterface

### Class app\strategies\TropicalOilsUnloadStrategy
класс объекта стратегии разгрузки продукции типа "Тропические масла".  
Особенность разгрузки типа "Тропические масла":  
груз наливной. Разгрузка возможна при условии, что текущий доступный объем на складе не менее объема груза в цистерне.
**публичные методы:**
см. интерфейс app\strategies\StrategyInterface

## Событийная модель

### Class app\observers\ObserveConsoleGatewayEnd
класс объекта слушателя события `GATEWAY_DONE`  
**публичные методы:**
| Метод     | Входящие типы                                       | Возвращаемый тип | Описание                      |
|-----------|-----------------------------------------------------|------------------|-------------------------------|
| observe() | app\components\Message $message - сообщение события | void             | выполнить действие по событию |

### Class app\observers\ObserveConsoleGatewayStart
класс объекта слушателя события `GATEWAY_START`  
**публичные методы:**
| Метод     | Входящие типы                                       | Возвращаемый тип | Описание                      |
|-----------|-----------------------------------------------------|------------------|-------------------------------|
| observe() | app\components\Message $message - сообщение события | void             | выполнить действие по событию |

### Class app\observers\ObserveConsoleProcessTruckDone
класс объекта слушателя события `PROCESS_TRUCK_DONE`  
**публичные методы:**
| Метод     | Входящие типы                                       | Возвращаемый тип | Описание                      |
|-----------|-----------------------------------------------------|------------------|-------------------------------|
| observe() | app\components\Message $message - сообщение события | void             | выполнить действие по событию |

### Class app\observers\ObserveConsoleProcessTruckFail
класс объекта слушателя события `PROCESS_TRUCK_FAIL`  
**публичные методы:**
| Метод     | Входящие типы                                       | Возвращаемый тип | Описание                      |
|-----------|-----------------------------------------------------|------------------|-------------------------------|
| observe() | app\components\Message $message - сообщение события | void             | выполнить действие по событию |

### Class app\observers\ObserveConsoleProcessTruckStart
класс объекта слушателя события `PROCESS_TRUCK_START`  
**публичные методы:**
| Метод     | Входящие типы                                       | Возвращаемый тип | Описание                      |
|-----------|-----------------------------------------------------|------------------|-------------------------------|
| observe() | app\components\Message $message - сообщение события | void             | выполнить действие по событию |

### Class app\observers\ObserveGatewayEnd
класс объекта слушателя события `GATEWAY_DONE`  
**публичные методы:**
| Метод     | Входящие типы                                       | Возвращаемый тип | Описание                      |
|-----------|-----------------------------------------------------|------------------|-------------------------------|
| observe() | app\components\Message $message - сообщение события | void             | выполнить действие по событию |

### Class app\observers\ObserveGatewayStart
класс объекта слушателя события `GATEWAY_START`  
**публичные методы:**
| Метод     | Входящие типы                                       | Возвращаемый тип | Описание                      |
|-----------|-----------------------------------------------------|------------------|-------------------------------|
| observe() | app\components\Message $message - сообщение события | void             | выполнить действие по событию |

### Class app\observers\ObserveOutputCollected
класс объекта слушателя события `GATEWAY_DONE`  
особое назначение: создать лог вывода в формате html в директории проекта runtime. Маска названия файла `log-{юникс_отметка_времени}.html`  
**публичные методы:**
| Метод     | Входящие типы                                       | Возвращаемый тип | Описание                      |
|-----------|-----------------------------------------------------|------------------|-------------------------------|
| observe() | app\components\Message $message - сообщение события | void             | выполнить действие по событию |

### Class app\observers\ObserveOutputCollection
класс объекта слушателя события `GATEWAY_START`  
особое назначение: запуск буфера сбора вывода  
**публичные методы:**
| Метод     | Входящие типы                                       | Возвращаемый тип | Описание                      |
|-----------|-----------------------------------------------------|------------------|-------------------------------|
| observe() | app\components\Message $message - сообщение события | void             | выполнить действие по событию |

### Class app\observers\ObserveProcessTruckDone
класс объекта слушателя события `PROCESS_TRUCK_DONE`  
**публичные методы:**
| Метод     | Входящие типы                                       | Возвращаемый тип | Описание                      |
|-----------|-----------------------------------------------------|------------------|-------------------------------|
| observe() | app\components\Message $message - сообщение события | void             | выполнить действие по событию |

### Class app\observers\ObserveProcessTruckFail
класс объекта слушателя события `PROCESS_TRUCK_FAIL`  
**публичные методы:**
| Метод     | Входящие типы                                       | Возвращаемый тип | Описание                      |
|-----------|-----------------------------------------------------|------------------|-------------------------------|
| observe() | app\components\Message $message - сообщение события | void             | выполнить действие по событию |

### Class app\observers\ObserveProcessTruckStart
класс объекта слушателя события `PROCESS_TRUCK_START`  
**публичные методы:**
| Метод     | Входящие типы                                       | Возвращаемый тип | Описание                      |
|-----------|-----------------------------------------------------|------------------|-------------------------------|
| observe() | app\components\Message $message - сообщение события | void             | выполнить действие по событию |

### Class app\SlotsLoadHandler
класс объекта обработчика загрузки слотов склада объемами типов продукции (см. Описание бизнес процесса)  
**публичные методы**  
| Метод    | Входящие типы                                | Возвращаемый тип | Описание            |
|----------|----------------------------------------------|------------------|---------------------|
| handle() | app\DTO $context - контекст данных обработки | void             | обработка контекста |